---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import { readFileSync } from 'fs';
import { join } from 'path';

// Read content from CMS files
let homeContent;
try {
  const homePath = join(process.cwd(), 'src/content/home.md');
  const homeRaw = readFileSync(homePath, 'utf-8');
  const frontmatter = homeRaw.split('---')[1];
  const body = homeRaw.split('---')[2];
  
  // Parse frontmatter manually
  const title = frontmatter.match(/title:\s*"([^"]+)"/)?.[1] || 'Aries Group';
  const heroTitle = frontmatter.match(/hero_title:\s*"([^"]+)"/)?.[1] || 'European Leader in Sheet Metal Processing';
  const heroDescription = frontmatter.match(/hero_description:\s*"([^"]+)"/)?.[1] || 'Precision manufacturing solutions';
  
  homeContent = { title, heroTitle, heroDescription, body };
} catch (error) {
  // Fallback content if file doesn't exist
  homeContent = {
    title: 'Aries Group',
    heroTitle: 'European Leader in Sheet Metal Processing',
    heroDescription: 'Aries Group provides comprehensive sheet metal processing solutions with cutting-edge technology and decades of expertise.',
    body: 'Welcome to Aries Group - your trusted partner in precision manufacturing.'
  };
}

const metadata = {
  title: homeContent.title,
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget using CMS content -->
  <Hero
    actions={[
      {
        variant: 'primary',
        text: 'Contact Us',
        href: '/contact',
      },
      { text: 'Learn more', href: '/about' },
    ]}
    image={{ src: '~/assets/images/hero-image.png', alt: 'Aries Group' }}
  >
    <Fragment slot="title">
      {homeContent.heroTitle}
    </Fragment>

    <Fragment slot="subtitle">
      {homeContent.heroDescription}
    </Fragment>
  </Hero>

  <!-- Content section with CMS body content -->
  <div class="max-w-4xl mx-auto px-4 py-16 text-center">
    <div class="prose prose-lg mx-auto dark:prose-invert">
      <Fragment set:html={homeContent.body} />
    </div>
  </div>
</Layout>